# Insert or replace a PMP area/param value

f = $fb.query('(and (eq what "pmp") (eq area "{{ area }}"))').each.to_a.first
if f.nil?
  f = $fb.insert
  f.what = 'pmp'
  f.area = '{{ area }}'
  f.send('{{ param }}=', '{{ value }}'.to_i)
else
  before = {}
  f.all_properties.each do |p|
    next if p == '{{ param }}'
    before[p] = f[p]
  end
  before['{{ param }}'] = ['{{ value }}'.to_i]
  $fb.query('(and (eq what "pmp") (eq area "{{ area }}"))').delete!
  f = $fb.insert
  f.what = 'pmp'
  f.area = '{{ area }}'
  before.each do |k, vv|
    vv.each do |v|
      f.send("#{k}=", v)
    end
  end
end
